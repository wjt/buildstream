

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Utilities &mdash; BuildStream 1.93.5+436.g5ebe6ab3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="buildstream.testing package" href="buildstream.testing.html" />
    <link rel="prev" title="Exceptions - API for Error Handling" href="buildstream.exceptions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> BuildStream
          

          
          </a>

          
            
            
              <div class="version">
                1.93.5+436.g5ebe6ab3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main_about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_using.html">Using</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="main_core.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core_format.html">Project format</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_plugins.html">Plugin specific documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="core_framework.html">Plugin API reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="buildstream.types.html">Foundation types</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.node.html">Node - Parsed YAML configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.plugin.html">Plugin - Base plugin class</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.source.html">Source - Base source class</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.source.html#sourcefetcher-object-for-fetching-individual-urls">SourceFetcher - Object for fetching individual URLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.downloadablefilesource.html">DownloadableFileSource - Abstract class for sources downloaded from a URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.element.html">Element - Base element class</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.buildelement.html">BuildElement - Abstract class for build elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.scriptelement.html">ScriptElement - Abstract class for scripting elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.sandbox.sandbox.html">Sandbox - The build sandbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.exceptions.html">Exceptions - API for Error Handling</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildstream.testing.html">buildstream.testing package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="core_additional.html">Additional writings</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildstream.html">buildstream package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="main_glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BuildStream</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="main_core.html">Reference</a> &raquo;</li>
        
          <li><a href="core_framework.html">Plugin API reference</a> &raquo;</li>
        
      <li>Utilities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/buildstream.utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="module-buildstream.utils"></span><div class="section" id="utilities">
<h1>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h1>
<dl class="py exception">
<dt id="buildstream.utils.UtilError">
<em class="property"><span class="pre">exception</span> </em><code class="sig-name descname"><span class="pre">UtilError</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildstream.utils.UtilError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">buildstream._exceptions.BstError</span></code></p>
<p>Raised by utility functions when system calls fail.</p>
<p>This will be handled internally by the BuildStream core,
if you need to handle this error, then it should be reraised,
or either of the <a class="reference internal" href="buildstream.element.html#buildstream.element.ElementError" title="buildstream.element.ElementError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElementError</span></code></a> or <a class="reference internal" href="buildstream.source.html#buildstream.source.SourceError" title="buildstream.source.SourceError"><code class="xref py py-class docutils literal notranslate"><span class="pre">SourceError</span></code></a>
exceptions should be raised from this error.</p>
</dd></dl>

<dl class="py exception">
<dt id="buildstream.utils.ProgramNotFoundError">
<em class="property"><span class="pre">exception</span> </em><code class="sig-name descname"><span class="pre">ProgramNotFoundError</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildstream.utils.ProgramNotFoundError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">buildstream._exceptions.BstError</span></code></p>
<p>Raised if a required program is not found.</p>
<p>It is normally unneeded to handle this exception from plugin code.</p>
</dd></dl>

<dl class="py exception">
<dt id="buildstream.utils.DirectoryExistsError">
<em class="property"><span class="pre">exception</span> </em><code class="sig-name descname"><span class="pre">DirectoryExistsError</span></code><a class="headerlink" href="#buildstream.utils.DirectoryExistsError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">OSError</span></code></p>
<p>Raised when a <cite>os.rename</cite> is attempted but the destination is an existing directory.</p>
</dd></dl>

<dl class="py class">
<dt id="buildstream.utils.FileListResult">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">FileListResult</span></code><a class="headerlink" href="#buildstream.utils.FileListResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An object which stores the result of one of the operations
which run on a list of files.</p>
<dl class="py attribute">
<dt id="buildstream.utils.FileListResult.overwritten">
<code class="sig-name descname"><span class="pre">overwritten</span></code><a class="headerlink" href="#buildstream.utils.FileListResult.overwritten" title="Permalink to this definition">¶</a></dt>
<dd><p>List of files which were overwritten in the target directory</p>
</dd></dl>

<dl class="py attribute">
<dt id="buildstream.utils.FileListResult.ignored">
<code class="sig-name descname"><span class="pre">ignored</span></code><a class="headerlink" href="#buildstream.utils.FileListResult.ignored" title="Permalink to this definition">¶</a></dt>
<dd><p>List of files which were ignored, because they would have
replaced a non empty directory</p>
</dd></dl>

<dl class="py attribute">
<dt id="buildstream.utils.FileListResult.failed_attributes">
<code class="sig-name descname"><span class="pre">failed_attributes</span></code><a class="headerlink" href="#buildstream.utils.FileListResult.failed_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>List of files for which attributes could not be copied over</p>
</dd></dl>

<dl class="py attribute">
<dt id="buildstream.utils.FileListResult.files_written">
<code class="sig-name descname"><span class="pre">files_written</span></code><a class="headerlink" href="#buildstream.utils.FileListResult.files_written" title="Permalink to this definition">¶</a></dt>
<dd><p>List of files that were written.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.list_relative_paths">
<code class="sig-name descname"><span class="pre">list_relative_paths</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#buildstream.utils.list_relative_paths" title="Permalink to this definition">¶</a></dt>
<dd><p>A generator for walking directory relative paths</p>
<p>This generator is useful for checking the full manifest of
a directory.</p>
<p>Symbolic links will not be followed, but will be included
in the manifest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>directory</strong> – The directory to list files in</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>Relative filenames in <cite>directory</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.glob">
<code class="sig-name descname"><span class="pre">glob</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">paths</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#buildstream.utils.glob" title="Permalink to this definition">¶</a></dt>
<dd><p>A generator to yield paths which match the glob pattern</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>paths</strong> (<em>iterable</em>) – The paths to check</p></li>
<li><p><strong>pattern</strong> (<em>str</em>) – A glob pattern</p></li>
</ul>
</dd>
</dl>
<p>This generator will iterate over the passed <em>paths</em> and
yield only the filenames which matched the provided <em>pattern</em>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Meta</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>*</p></td>
<td><p>Zero or more of any character, excepting path separators</p></td>
</tr>
<tr class="row-odd"><td><p>**</p></td>
<td><p>Zero or more of any character, including path separators</p></td>
</tr>
<tr class="row-even"><td><p>?</p></td>
<td><p>One of any character, except for path separators</p></td>
</tr>
<tr class="row-odd"><td><p>[abc]</p></td>
<td><p>One of any of the specified characters</p></td>
</tr>
<tr class="row-even"><td><p>[a-z]</p></td>
<td><p>One of the characters in the specified range</p></td>
</tr>
<tr class="row-odd"><td><p>[!abc]</p></td>
<td><p>Any single character, except the specified characters</p></td>
</tr>
<tr class="row-even"><td><p>[!a-z]</p></td>
<td><p>Any single character, except those in the specified range</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Escaping of the metacharacters is not possible</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.sha256sum">
<code class="sig-name descname"><span class="pre">sha256sum</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#buildstream.utils.sha256sum" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the sha256sum of a file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> – A path to a file on disk</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An sha256 checksum string</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case there was an issue opening
    or reading <cite>filename</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.safe_copy">
<code class="sig-name descname"><span class="pre">safe_copy</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copystat</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#buildstream.utils.FileListResult" title="buildstream.utils.FileListResult"><span class="pre">buildstream.utils.FileListResult</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#buildstream.utils.safe_copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy a file while optionally preserving attributes</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – The source filename</p></li>
<li><p><strong>dest</strong> – The destination filename</p></li>
<li><p><strong>copystat</strong> – Whether to preserve attributes</p></li>
<li><p><strong>result</strong> – An optional collective result</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case of unexpected system call failures</p>
</dd>
</dl>
<p>This is almost the same as shutil.copy2() when copystat is True,
except that we unlink <em>dest</em> before overwriting it if it exists, just
incase <em>dest</em> is a hardlink to a different file.</p>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.safe_link">
<code class="sig-name descname"><span class="pre">safe_link</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#buildstream.utils.FileListResult" title="buildstream.utils.FileListResult"><span class="pre">buildstream.utils.FileListResult</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_unlink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#buildstream.utils.safe_link" title="Permalink to this definition">¶</a></dt>
<dd><p>Try to create a hardlink, but resort to copying in the case of cross device links.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – The source filename</p></li>
<li><p><strong>dest</strong> – The destination filename</p></li>
<li><p><strong>result</strong> – An optional collective result</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case of unexpected system call failures</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.safe_remove">
<code class="sig-name descname"><span class="pre">safe_remove</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#buildstream.utils.safe_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes a file or directory</p>
<p>This will remove a file if it exists, and will
remove a directory if the directory is empty.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> – The path to remove</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if <cite>path</cite> was removed or did not exist, False
if <cite>path</cite> was a non empty directory.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case of unexpected system call failures</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.copy_files">
<code class="sig-name descname"><span class="pre">copy_files</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_callback</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_missing</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report_written</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#buildstream.utils.FileListResult" title="buildstream.utils.FileListResult"><span class="pre">buildstream.utils.FileListResult</span></a><a class="headerlink" href="#buildstream.utils.copy_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy files from source to destination.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – The source directory</p></li>
<li><p><strong>dest</strong> – The destination directory</p></li>
<li><p><strong>filter_callback</strong> – Optional filter callback. Called with the relative path as
argument for every file in the source directory. The file is
copied only if the callable returns True. If no filter callback
is specified, all files will be copied.</p></li>
<li><p><strong>ignore_missing</strong> – Dont raise any error if a source file is missing</p></li>
<li><p><strong>report_written</strong> – Add to the result object the full list of files written</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The result describing what happened during this file operation</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case of unexpected system call failures</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Directories in <cite>dest</cite> are replaced with files from <cite>src</cite>,
unless the existing directory in <cite>dest</cite> is not empty in which
case the path will be reported in the return value.</p>
<p>UNIX domain socket files from <cite>src</cite> are ignored.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.link_files">
<code class="sig-name descname"><span class="pre">link_files</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_callback</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_missing</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report_written</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#buildstream.utils.FileListResult" title="buildstream.utils.FileListResult"><span class="pre">buildstream.utils.FileListResult</span></a><a class="headerlink" href="#buildstream.utils.link_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Hardlink files from source to destination.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – The source directory</p></li>
<li><p><strong>dest</strong> – The destination directory</p></li>
<li><p><strong>filter_callback</strong> – Optional filter callback. Called with the relative path as
argument for every file in the source directory. The file is
hardlinked only if the callable returns True. If no filter
callback is specified, all files will be hardlinked.</p></li>
<li><p><strong>ignore_missing</strong> – Dont raise any error if a source file is missing</p></li>
<li><p><strong>report_written</strong> – Add to the result object the full list of files written</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The result describing what happened during this file operation</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference internal" href="#buildstream.utils.UtilError" title="buildstream.utils.UtilError"><strong>UtilError</strong></a> – In the case of unexpected system call failures</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Directories in <cite>dest</cite> are replaced with files from <cite>src</cite>,
unless the existing directory in <cite>dest</cite> is not empty in which
case the path will be reported in the return value.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a hardlink cannot be created due to crossing filesystems,
then the file will be copied instead.</p>
<p>UNIX domain socket files from <cite>src</cite> are ignored.</p>
</div>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.get_host_tool">
<code class="sig-name descname"><span class="pre">get_host_tool</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#buildstream.utils.get_host_tool" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the full path of a host tool</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – The name of the program to search for</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The full path to the program, if found</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference internal" href="#buildstream.utils.ProgramNotFoundError" title="buildstream.utils.ProgramNotFoundError"><strong>ProgramNotFoundError</strong></a> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.get_bst_version">
<code class="sig-name descname"><span class="pre">get_bst_version</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#buildstream.utils.get_bst_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the major, minor release portion of the
BuildStream version.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A 2-tuple of form (major version, minor version)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.move_atomic">
<code class="sig-name descname"><span class="pre">move_atomic</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">destination</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pathlib.Path</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensure_parents</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#buildstream.utils.move_atomic" title="Permalink to this definition">¶</a></dt>
<dd><p>Move the source to the destination using atomic primitives.</p>
<p>This uses <cite>os.rename</cite> to move a file or directory to a new destination.
It wraps some <cite>OSError</cite> thrown errors to ensure their handling is correct.</p>
<p>The main reason for this to exist is that rename can throw different errors
for the same symptom (<a class="reference external" href="https://www.unix.com/man-page/POSIX/3posix/rename/">https://www.unix.com/man-page/POSIX/3posix/rename/</a>)
when we are moving a directory.</p>
<p>We are especially interested here in the case when the destination already
exists, is a directory and is not empty. In this case, either EEXIST or
ENOTEMPTY can be thrown.</p>
<p>In order to ensure consistent handling of these exceptions, this function
should be used instead of <cite>os.rename</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>source</strong> – source to rename</p></li>
<li><p><strong>destination</strong> – destination to which to move the source</p></li>
<li><p><strong>ensure_parents</strong> – Whether or not to create the parent’s directories
of the destination (default: True)</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference internal" href="#buildstream.utils.DirectoryExistsError" title="buildstream.utils.DirectoryExistsError"><strong>DirectoryExistsError</strong></a> – if the destination directory already exists and is
    not empty</p></li>
<li><p><strong>OSError</strong> – if another filesystem level error occured</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.save_file_atomic">
<code class="sig-name descname"><span class="pre">save_file_atomic</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'w'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffering</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoding</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newline</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">closefd</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opener</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tempdir</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">IO</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#buildstream.utils.save_file_atomic" title="Permalink to this definition">¶</a></dt>
<dd><p>Save a file with a temporary name and rename it into place when ready.</p>
<p>This is a context manager which is meant for saving data to files.
The data is written to a temporary file, which gets renamed to the target
name when the context is closed. This avoids readers of the file from
getting an incomplete file.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">save_file_atomic</span><span class="p">(</span><span class="s1">&#39;/path/to/foo&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span>
</pre></div>
</div>
<p>The file will be called something like <code class="docutils literal notranslate"><span class="pre">tmpCAFEBEEF</span></code> until the
context block ends, at which point it gets renamed to <code class="docutils literal notranslate"><span class="pre">foo</span></code>. The
temporary file will be created in the same directory as the output file.
The <code class="docutils literal notranslate"><span class="pre">filename</span></code> parameter must be an absolute path.</p>
<p>If an exception occurs or the process is terminated, the temporary file will
be deleted.</p>
</dd></dl>

<dl class="py function">
<dt id="buildstream.utils.get_umask">
<code class="sig-name descname"><span class="pre">get_umask</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildstream.utils.get_umask" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="buildstream.testing.html" class="btn btn-neutral float-right" title="buildstream.testing package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="buildstream.exceptions.html" class="btn btn-neutral float-left" title="Exceptions - API for Error Handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2020, The BuildStream Contributors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>